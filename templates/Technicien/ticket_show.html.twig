{% extends 'base.html.twig' %}

{% block title %}Détail du ticket (Technicien){% endblock %}

{% block content %}
    <style>
        body {
            background: #f4f6f9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .ticket-detail-container {
            max-width: 1000px;
            margin: 50px auto;
            background: white;
            padding: 36px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        .btn-back-arrow-in-card {
            text-decoration: none;
            font-size: 1.4rem;
            color: #4e944f;
            display: inline-block;
            margin-bottom: 20px;
        }

        .ticket-detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
        }

        .ticket-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            margin-right: 16px;
            border: 2px solid #a4c639;
        }

        .ticket-user-info {
            display: flex;
            flex-direction: column;
        }

        .ticket-user-name {
            font-weight: bold;
            font-size: 1.2rem;
            color: #4e944f;
        }

        .ticket-date {
            color: #888;
            font-size: 0.95rem;
        }

        .ticket-detail-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .ticket-detail-list {
            list-style: none;
            padding: 0;
            margin-bottom: 30px;
        }

        .ticket-detail-list li {
            margin-bottom: 10px;
        }

        .ticket-detail-label {
            font-weight: 600;
            color: #4e944f;
        }

        .ticket-detail-value {
            margin-left: 8px;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-priorite-basse {
            background: #6ab04c;
            color: white;
        }

        .badge-priorite-moyenne {
            background: #e6b800;
            color: white;
        }

        .badge-priorite-haute {
            background: #eb4d4b;
            color: white;
        }

        .badge-statut-en_attente {
            background: #e67e22;
            color: white;
        }

        .badge-statut-en_cours {
            background: #3498db;
            color: white;
        }

        .badge-statut-terminee,
        .badge-statut-resolu {
            background: #2ecc71;
            color: white;
        }

        .comments-section h3 {
            color: #4e944f;
        }

        .comments-list li {
            background: #f7fbe8;
            border: 1px solid #a4c639;
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .comments-list .author {
            font-weight: bold;
            color: #4e944f;
        }

        textarea {
            border: 1.5px solid #a4c639;
            border-radius: 6px;
            background: #fffbe8;
        }

        .btn-success {
            background: linear-gradient(90deg, #a4c639 0%, #d0e97a 100%);
            color: #fff;
            font-weight: bold;
        }

        .btn-primary {
            background: #4e944f;
            border: none;
        }
    </style>


<div class="ticket-detail-container">
    <a href="{{ path('technicien_tickets') }}" class="btn-back-arrow-in-card" title="Retour à la liste">&#8592;</a>

    <div class="ticket-detail-header">
        <img src="{{ asset('assets/images/default-user.png') }}" class="ticket-avatar" alt="avatar">
        <div class="ticket-user-info">
            <span class="ticket-user-name">{{ ticket.utilisateur.nom }} {{ ticket.utilisateur.prenom }}</span>
            <span class="ticket-date">Créé le {{ ticket.dateCreation|date('d/m/Y H:i') }}</span>
        </div>
    </div>

    <div class="ticket-detail-title">{{ ticket.titre }}</div>

    <ul class="ticket-detail-list">
        <li>
            <span class="ticket-detail-label">Description :</span>
            <span class="ticket-detail-value">{{ ticket.description }}</span>
        </li>
        <li>
            <span class="ticket-detail-label">Statut :</span>
            <span class="ticket-detail-value">
                <span class="badge badge-statut-{{ ticket.statut.name|lower }}">
                    {{ ticket.statut.value }}
                </span>
            </span>
        </li>
        <li>
            <span class="ticket-detail-label">Priorité :</span>
            <span class="ticket-detail-value">
                <span class="badge badge-priorite-{{ ticket.priorite.value|lower }}">
                    {{ ticket.priorite.value }}
                </span>
            </span>
        </li>
    </ul>

    <form method="post" action="{{ path('technicien_ticket_show', {id: ticket.idTicket}) }}" style="margin-top:18px;">
        <label for="statut" style="font-weight:600; color:#6a8a1a;">Changer le statut :</label>
        <select id="statut" name="statut" class="form-control mb-2">
            <option value="EN_ATTENTE" {% if ticket.statut.name == 'EN_ATTENTE' %}selected{% endif %}>En attente</option>
            <option value="EN_COURS" {% if ticket.statut.name == 'EN_COURS' %}selected{% endif %}>En cours</option>
            <option value="TERMINEE" {% if ticket.statut.name == 'TERMINEE' %}selected{% endif %}>Résolu</option>
        </select>

        <button type="submit" name="changer_statut" class="btn btn-primary w-100">Mettre à jour le statut</button>
    </form>

    <div class="comments-section" style="margin-top:36px;">
        <h3>Commentaires / Diagnostics</h3>
        {% if commentaires is not empty %}
            <ul class="comments-list">
                {% for commentaire in commentaires %}
                    <li>
                        <div class="author">
                            {{ commentaire.utilisateur.nom }} {{ commentaire.utilisateur.prenom }}
                            <span style="font-size:0.95em; color:#888; font-weight:400; margin-left:8px;">
                                le {{ commentaire.dateCommentaire|date('d/m/Y H:i') }}
                            </span>
                        </div>
                        <div style="color:#444; font-size:1.05em;">
                            {{ commentaire.contenu }}
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div style="color:#888;">Aucun commentaire pour ce ticket.</div>
        {% endif %}

        <form method="post" style="margin-top:18px;">
            <label for="contenu_commentaire" style="font-weight:600; color:#6a8a1a;">Ajouter un diagnostic ou commentaire technique :</label>
            <textarea id="contenu_commentaire" name="contenu_commentaire" rows="2" required></textarea>
            <button type="submit" class="btn btn-success w-100">Commenter</button>
        </form>
    </div>
</div>
{% endblock %}
